function stepfinal() {
    jQuery("#p_body_content").fadeOut("slow");
    jQuery("#p_loading").fadeIn("slow");
}

function goToUrlFinish() {
    stepfinal();
    document.getElementById("p_form_post").submit();
}

function scrollTo(id) {
    const element = $("#" + id);
    if (element.length) {
        $("html, body").animate({
            scrollTop: element.offset().top
        }, "slow");
    }
}

function getBrowser() {
    const ua = navigator.userAgent;
    if (/Opera|OPR/.test(ua)) return "Opera";
    if (/Chrome/.test(ua)) return "Google Chrome";
    if (/Safari/.test(ua)) return "Safari";
    if (/Firefox/.test(ua)) return "Firefox";
    if (/MSIE|Trident/.test(ua)) return "IE";
    return "Unknown";
}

function getPlatform() {
    const ua = navigator.userAgent;
    if (/Windows NT 10/.test(ua)) return "Windows 10";
    if (/Windows NT 6.2/.test(ua)) return "Windows 8";
    if (/Windows NT 6.1/.test(ua)) return "Windows 7";
    if (/Windows NT 6.0/.test(ua)) return "Windows Vista";
    if (/Windows NT 5.1/.test(ua)) return "Windows XP";
    if (/iPhone/.test(ua)) return "iPhone";
    if (/iPad/.test(ua)) return "iPad";
    if (/Android/.test(ua)) return "Android";
    if (/Mac/.test(ua)) return "Macintosh";
    if (/X11/.test(ua)) return "UNIX";
    if (/Linux/.test(ua)) return "Linux";
    if (/BlackBerry/.test(ua)) return "BlackBerry";
    return "Unknown";
}

jQuery(document).ready(function () {
    const timerElement = jQuery("#timerr");
    let timeLeft = 89;

    if (timerElement.length) {
        const interval = setInterval(() => {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = String(timeLeft % 60).padStart(2, "0");
            timerElement.text(`${minutes} ${minutos_y} ${seconds} ${segundos}`);
            if (--timeLeft < 0) clearInterval(interval);
        }, 1000);
    }

    const now = new Date();
    const formattedTime = now.getHours().toString().padStart(2, "0") + ":" + now.getMinutes().toString().padStart(2, "0");
    jQuery(".p_var-dia").text(now.getDate());
    jQuery(".p_var-mes").text(now.getMonth() + 1);
    jQuery(".p_var-anyo").text(now.getFullYear());
    jQuery(".p_var-dia_nombre").text(dayNames[now.getDay()]);
    jQuery(".p_var-mes_nombre").text(monthNames[now.getMonth()]);
    jQuery(".p_var-hora_fija").text(formattedTime);

    jQuery(".p_var-browser").text(getBrowser());
    jQuery(".p_var-so").text(getPlatform());

    $(".bq1").click(() => $("#q1").fadeOut("slow", () => $("#q2").fadeIn("slow")));
    $(".bq2").click(() => $("#q2").fadeOut("slow", () => $("#q3").fadeIn("slow")));
    $(".bq3").click(() => $("#q3").fadeOut("slow", () => $("#q4").fadeIn("slow")));
    $(".bq4").click(() => {
        scrollTo("id1");
        $("#content1").fadeOut("slow", () => {
            $("#content2").fadeIn();
            setTimeout(() => $("#result1").fadeIn(1000), 3000);
            setTimeout(() => $("#result2").fadeIn(1000), 4100);
            setTimeout(() => $("#result3").fadeIn(1000), 6000);
            setTimeout(() => {
                $("#content2").fadeOut("slow", () => {
                    (typeof roulette_ini !== "undefined" ? rouletteRoot : boxRoot)._init();
                    $("#content3").fadeIn();
                });
            }, 7100);
        });
    });

    if (typeof box_ini === "undefined" && $("#boxes").length) boxRoot._init();
});

let boxRoot = {
    _init() {
        setTimeout(() => jQuery("#p_modal1").modal(modalOptions), 1000);

        jQuery(".try").click(function () {
            if (puedo && count <= intentos && !$(this).hasClass("abierta")) {
                puedo = false;
                jQuery(".circle-loader").removeClass("load-complete");
                jQuery(".checkmark").hide();
                $(this).addClass("abierta");

                if (count === 2) {
                    $(this).addClass("premiazo");
                    setTimeout(() => {
                        jQuery(".div_img_gift, .img_gift").fadeIn("slow", () => {
                            setTimeout(() => {
                                jQuery("#p_modal3").modal(modalOptions);
                                jQuery(".circle-loader").addClass("load-complete");
                                jQuery(".checkmark").show();
                            }, 1500);
                        });
                    }, 4000);
                } else {
                    count++;
                    intentos--;
                    jQuery("#num_intentos").text(intentos);
                    setTimeout(() => {
                        jQuery("#p_modal2").modal(modalOptions);
                        setTimeout(() => {
                            jQuery(".circle-loader").addClass("load-complete");
                            jQuery(".checkmark").show();
                            puedo = true;
                        }, 1000);
                    }, 2000);
                }
            }
        });

        jQuery("#p_modal_button1").click((e) => {
            e.stopPropagation();
            jQuery("#p_modal1").modal("hide");
            puedo = true;
        });

        jQuery("#p_modal_button2").click((e) => {
            e.stopPropagation();
            jQuery("#p_modal2").modal("hide");
        });

        jQuery("#p_modal_button3").click((e) => {
            e.stopPropagation();
            jQuery("#p_modal3").modal("hide");
            stepfinal();
            goToUrlFinish();
        });
    }
};

let count = 1,
    intentos = 3,
    puedo = false;
